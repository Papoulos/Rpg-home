<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu de Rôle en Ligne</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <aside class="panel left-panel">
            <h2>Chat</h2>
            <div class="chat-messages" id="chat-messages">
                <!-- Les messages du chat apparaîtront ici -->
            </div>
            <div class="chat-input-area">
                <input type="text" id="chat-input" placeholder="Écrivez votre message...">
                <button id="send-button">Envoyer</button>
            </div>
            <div class="dice-roller">
                <h3>Lancer de dés</h3>
                <button class="dice-button" data-die="4">4</button>
                <button class="dice-button" data-die="6">6</button>
                <button class="dice-button" data-die="10">10</button>
                <button class="dice-button" data-die="20">20</button>
                <button class="dice-button" data-die="100">100</button>
            </div>
        </aside>
        <div class="resizer" id="resizer-left"></div>
        <main class="main-content">
            <div class="main-display">
                <div id="carte-content" class="tab-content">
                    <!-- Contrôles pour le MJ, cachés par défaut -->
                    <div class="image-controls hidden">
                        <select id="image-select">
                            <option value="">Choisir une image</option>
                        </select>
                        <button id="add-image-btn" class="control-btn btn-add" title="Ajouter une image"><span class="material-symbols-outlined">add</span></button>
                        <button id="delete-image-btn" class="control-btn btn-delete" title="Supprimer l'image"><span class="material-symbols-outlined">remove</span></button>
                    </div>

                    <!-- Zone d'affichage de l'image, visible par tous -->
                    <div id="image-display-area">
                        <p>Aucune image sélectionnée.</p>
                    </div>
                </div>
                <div id="pj-content" class="tab-content">
                    <div class="sheets-controls">
                        <select id="sheet-select">
                            <option value="">Choisir une fiche</option>
                        </select>
                        <button id="add-sheet-btn" class="control-btn btn-add" title="Ajouter une fiche"><span class="material-symbols-outlined">add</span></button>
                        <button id="delete-sheet-btn" class="control-btn btn-delete" title="Supprimer la fiche"><span class="material-symbols-outlined">remove</span></button>
                    </div>
                    <div id="sheet-display-area">
                        <!-- L'iframe de la Google Sheet ira ici -->
                    </div>
                </div>
                <div id="fabric-content" class="tab-content">
                    <div class="whiteboard-controls">
                        <div id="fabric-toolbar">
                            <button id="fabric-select-tool" class="control-btn" title="Select"><span class="material-symbols-outlined">pan_tool</span></button>
                            <button id="fabric-pointer-tool" class="control-btn" title="Pointer"><span class="material-symbols-outlined">ads_click</span></button>
                            <button id="fabric-pencil-tool" class="control-btn" title="Pencil"><span class="material-symbols-outlined">edit</span></button>
                            <button id="fabric-line-tool" class="control-btn" title="Line"><span class="material-symbols-outlined">horizontal_rule</span></button>
                            <button id="fabric-rect-tool" class="control-btn" title="Rectangle"><span class="material-symbols-outlined">rectangle</span></button>
                            <button id="fabric-circle-tool" class="control-btn" title="Circle"><span class="material-symbols-outlined">circle</span></button>
                            <input type="file" id="fabric-image-input" style="display: none;" accept="image/*" />
                            <label for="fabric-image-input" class="control-btn" title="Add Image"><span class="material-symbols-outlined">add_photo_alternate</span></label>
                            <input type="file" id="fabric-background-image-input" style="display: none;" accept="image/*" />
                            <label for="fabric-background-image-input" class="control-btn" title="Set Background Image"><span class="material-symbols-outlined">image</span></label>
                            <input type="color" id="fabric-color-picker" class="control-btn" title="Color Picker" />
                            <button id="fabric-delete-tool" class="control-btn btn-delete" title="Delete"><span class="material-symbols-outlined">delete</span></button>

                            <!-- FOG OF WAR CONTROLS (MJ-only) -->
                            <div id="fabric-fog-toolbar" class="control-group hidden">
                                <span class="toolbar-divider"></span>
                                <button id="fabric-fog-tool" class="control-btn" title="Activer/Désactiver le brouillard"><span class="material-symbols-outlined">cloud</span></button>
                                <button id="fabric-fog-eraser-tool" class="control-btn" title="Gomme pour brouillard"><span class="material-symbols-outlined">ink_eraser</span></button>
                                <div class="brush-size-container">
                                    <input type="range" id="fabric-fog-brush-size" min="10" max="200" value="50" title="Taille de la gomme">
                                </div>
                            </div>
                        </div>
                    </div>
                    <canvas id="fabric-canvas"></canvas>
                </div>
                <div id="music-content" class="tab-content">
                    <div class="music-container hidden">
                        <!-- Main Player Controls -->
                        <div id="music-main-controls">
                            <div id="music-current-track">
                                <span id="music-current-title">Aucune musique sélectionnée</span>
                            </div>
                            <div class="main-buttons">
                                <button id="music-play-pause-btn" class="control-btn" title="Lecture">
                                    <span class="material-symbols-outlined">play_arrow</span>
                                </button>
                            </div>
                            <div class="volume-control">
                                <span class="material-symbols-outlined">volume_up</span>
                                <input type="range" id="music-volume-slider" min="0" max="100" value="100" title="Volume">
                            </div>
                        </div>

                        <!-- Add Song Section -->
                        <div id="music-add-section">
                            <input type="text" id="youtube-url-input" placeholder="Coller une URL YouTube pour l'ajouter à la playlist...">
                            <button id="music-add-btn" class="control-btn" title="Ajouter à la playlist">
                                <span class="material-symbols-outlined">playlist_add</span>
                            </button>
                        </div>

                        <!-- Playlist Options -->
                        <div id="music-playlist-options">
                            <label class="loop-control">
                                <input type="checkbox" id="music-loop-toggle">
                                <span class="material-symbols-outlined">loop</span>
                                <span>Boucle</span>
                            </label>
                        </div>

                        <!-- Playlist -->
                        <div id="music-playlist">
                            <!-- Playlist items will be generated by JavaScript -->
                        </div>
                    </div>

                    <!-- The invisible YouTube player -->
                    <div id="youtube-player"></div>
                </div>
            </div>
            <nav class="main-menu">
                <a href="#carte" class="menu-item" data-target="carte-content" title="Carte"><span class="material-symbols-outlined">map</span></a>
                <a href="#pj" class="menu-item" data-target="pj-content" title="Personnages"><span class="material-symbols-outlined">group</span></a>
                <a href="#fabric" class="menu-item" data-target="fabric-content" title="Tableau Blanc"><span class="material-symbols-outlined">draw</span></a>
                <a href="#music" class="menu-item hidden" data-target="music-content" id="music-nav-item" title="Musique"><span class="material-symbols-outlined">music_note</span></a>
            </nav>
        </main>
        <div class="resizer" id="resizer-right"></div>
        <aside class="panel right-panel">
            <div class="panel-header">
                <h2>Vidéo</h2>
                <div id="global-controls">
                    <button id="mute-mic-btn" title="Couper le micro"><span class="material-symbols-outlined">mic</span></button>
                    <button id="toggle-video-btn" title="Désactiver la caméra"><span class="material-symbols-outlined">videocam</span></button>
                </div>
            </div>
            <div id="video-grid">
                <!-- Les flux vidéo apparaîtront ici -->
            </div>
        </aside>

        <!-- Panel Toggles -->
        <button id="toggle-chat-btn" title="Cacher le panneau de chat">
            <span class="material-symbols-outlined">chevron_left</span>
        </button>
        <button id="toggle-video-panel-btn" title="Cacher le panneau de vidéo">
            <span class="material-symbols-outlined">chevron_right</span>
        </button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script src="navigation.js" defer></script>
    <script src="game-systems.js" defer></script>
    <script src="script.js" defer></script>
    <script src="sheets.js" defer></script>
    <script src="images.js" defer></script>
    <script src="fabric-whiteboard.js" defer></script>
    <script src="music.js" defer></script>
</body>
</html>
